var $m=$(".stage"),$imgList=$("#image-list"),origWord=$("#msg").html(),$msg=$("#msg"),$popup=$(".popup-gray"),$cpyMsg=$(".pic-detail .msg");$(".btn.btn-close").click(function(){$cpyMsg.fadeOut();$popup.fadeOut()});var clip=new ZeroClipboard($(".btn.btn-cpy")[0],{moviePath:"ZeroClipboard.swf"});clip.on("aftercopy",function(a){$cpyMsg.html("\u590d\u5236\u6210\u529f");$cpyMsg.fadeIn()});clip.on("error",function(a){$cpyMsg.html("\u590d\u5236\u9519\u8bef,\u8bf7\u624b\u52a8\u590d\u5236");$cpyMsg.fadeIn()});
function showDetail(a){$(".pic-detail img").attr("src",a.target.src||a.target.href);$(".pic-detail p span").html((a.target.src||a.target.href).substring(0,(a.target.src||a.target.href).lastIndexOf("!h500")));$(".btn.btn-cpy").attr("data-clipboard-text",(a.target.src||a.target.href).substring(0,(a.target.src||a.target.href).lastIndexOf("!h500")));$popup.fadeIn()}
$(document).on({dragleave:function(a){a.preventDefault()},drop:function(a){a.preventDefault()},dragenter:function(a){a.preventDefault()},dragover:function(a){a.preventDefault()}});$("#fu").on("change",function(a){doUpdate($("#fu").prop("files"))});$m.on("click",function(a){a.preventDefault();$("#fu").click()});
var doUpdate=function(a){if(1<a.length)return alert("\u5bf9\u4e0d\u8d77\uff0c\u60a8\u53ea\u80fd\u4e00\u6b21\u4e0a\u4f20\u4e2a\u6587\u4ef6"),!1;if(-1===a[0].type.indexOf("image"))return alert("\u60a8\u9009\u62e9\u7684\u4e0d\u662f\u56fe\u7247"),!1;$msg.html("\u6b63\u5728\u4e0a\u4f20\uff0c\u8bf7\u7a0d\u540e");doUpload(genName(a[0].name),a[0],function(a){a.success&&$("<a>").attr("href",a.url).append($("<img>").attr("src",a.url+"!h500").addClass("image-item").load(function(a){$(a.target).addClass("show")})).addClass("a-wrapper").click(function(a){a.preventDefault();
    showDetail(a)}).prependTo($imgList);$msg.html("\u4e0a\u4f20\u6210\u529f");setTimeout("$msg.html(origWord)",2E3)})};$m.get(0).addEventListener("drop",function(a){doUpdate(a.dataTransfer.files)});var genName=function(a){a=a.replace(/[\s\(\)]/ig,"_");return Date.now()+a};
$(function(){$.get("/a/getResent",function(a){if(200==a.code){var b=a.pics;for(i in b)$("<a>").attr({href:a.preDomain+b[i].realAddress,target:"_blank"}).append($("<img>").attr("src",a.preDomain+b[i].realAddress+"!h500").addClass("image-item").load(function(a){$(a.target).addClass("show")})).addClass("a-wrapper").click(function(a){a.preventDefault();showDetail(a)}).appendTo($imgList)}})});